{"version":3,"file":"preact-habitat.es.js","sources":["../src/lib.js","../src/index.js"],"sourcesContent":["import preact from \"preact\";\r\n/**\r\n * Removes `-` fron a string and capetalize the letter after\r\n * example: data-props-hello-world =>  dataPropsHelloWorld\r\n * Used for props passed from host DOM element\r\n * @param  {String} str string\r\n * @return {String} Capetalized string\r\n */\r\nconst camelcasize = str => {\r\n  return str.replace(/-([a-z])/gi, (all, letter) => {\r\n    return letter.toUpperCase();\r\n  });\r\n};\r\n\r\n/**\r\n * [getExecutedScript internal widget to provide the currently executed script]\r\n * @param  {document} document [Browser document object]\r\n * @return {HTMLElement}     [script Element]\r\n */\r\nconst getExecutedScript = () => {\r\n  return (\r\n    document.currentScript ||\r\n    (() => {\r\n      let scripts = document.getElementsByTagName(\"script\");\r\n      return scripts[scripts.length - 1];\r\n    })()\r\n  );\r\n};\r\n\r\n/**\r\n * Get the props from a host element's data attributes\r\n * @param  {Element} tag The host element\r\n * @return {Object}  props object to be passed to the component\r\n */\r\nconst collectPropsFromElement = (element, defaultProps = {}) => {\r\n  let attrs = element.attributes;\r\n\r\n  let props = Object.assign({}, defaultProps);\r\n\r\n  // collect from element\r\n  Object.keys(attrs).forEach(key => {\r\n    if (attrs.hasOwnProperty(key)) {\r\n      let dataAttrName = attrs[key].name;\r\n      if (!dataAttrName || typeof dataAttrName !== \"string\") {\r\n        return false;\r\n      }\r\n      let propName = dataAttrName.split(/(data-props?-)/).pop() || '';\r\n      propName = camelcasize(propName);\r\n      if (dataAttrName !== propName) {\r\n        let propValue = attrs[key].nodeValue;\r\n        props[propName] = propValue;\r\n      }\r\n    }\r\n  });\r\n\r\n  // check for child script text/props\r\n  [].forEach.call(element.getElementsByTagName('script'), scrp => {\r\n    let propsObj = {}\r\n    if(scrp.hasAttribute('type')) {\r\n      if (scrp.getAttribute('type') !== 'text/props' ) return;\r\n      try {\r\n        propsObj = JSON.parse(scrp.innerHTML);\r\n      } catch(e) {\r\n        throw new Error(e)\r\n      }\r\n      Object.assign(props, propsObj)\r\n    }\r\n  });  \r\n\r\n  return props;\r\n};\r\n\r\nconst getHabitatSelectorFromClient = (currentScript) => {\r\n  let scriptTagAttrs = currentScript.attributes;\r\n  let selector = null;\r\n  // check for another props attached to the tag\r\n  Object.keys(scriptTagAttrs).forEach(key => {\r\n    if (scriptTagAttrs.hasOwnProperty(key)) {\r\n      const dataAttrName = scriptTagAttrs[key].name;\r\n      if (dataAttrName === 'data-mount-in') {\r\n        selector = scriptTagAttrs[key].nodeValue;\r\n      }\r\n    }\r\n  });\r\n  return selector\r\n}\r\n\r\n/**\r\n * Return array of 0 or more elements that will host our widget\r\n * @param  {id} attrId the data widget id attribute the host should have\r\n * @param  {document} scope  Docuemnt object or DOM Element as a scope\r\n * @return {Array}        Array of matching habitats\r\n */\r\nconst widgetDOMHostElements = (\r\n  { selector, inline, clientSpecified}\r\n) => {\r\n  let hostNodes = [];\r\n  let currentScript = getExecutedScript();\r\n\r\n  if (inline === true) {\r\n    let parentNode = currentScript.parentNode;\r\n    hostNodes.push(parentNode);\r\n  }\r\n  if (clientSpecified === true && !selector) {\r\n    // user did not specify where to mount - get it from script tag attributes\r\n    selector = getHabitatSelectorFromClient(currentScript);\r\n  }\r\n  if (selector) {\r\n    [].forEach.call(document.querySelectorAll(selector), queriedTag => {\r\n      hostNodes.push(queriedTag);\r\n    });\r\n  }\r\n  return hostNodes;\r\n};\r\n\r\n/**\r\n * preact render function that will be queued if the DOM is not ready\r\n * and executed immeidatly if DOM is ready\r\n */\r\nconst preactRender = (widget, hostElements, root, cleanRoot, defaultProps) => {\r\n  hostElements.forEach(elm => {\r\n    let hostNode = elm;\r\n    if (hostNode._habitat) {\r\n      return; \r\n    }\r\n    hostNode._habitat = true;\r\n    let props = collectPropsFromElement(elm, defaultProps) || defaultProps;\r\n    if(cleanRoot) {\r\n      hostNode.innerHTML = \"\";\r\n    }\r\n    return preact.render(preact.h(widget, props), hostNode, root);\r\n  });\r\n};\r\n\r\nexport {\r\n  collectPropsFromElement,\r\n  widgetDOMHostElements,\r\n  getExecutedScript,\r\n  camelcasize,\r\n  preactRender,\r\n  getHabitatSelectorFromClient\r\n};\r\n","import { widgetDOMHostElements, preactRender } from \"./lib\";\r\n\r\nconst habitat = Widget => {\r\n  // Widget represents the Preact component we need to mount\r\n  let widget = Widget;\r\n  // preact root render helper\r\n  let root = null;\r\n\r\n  let render = (\r\n    {\r\n      selector = null,\r\n      inline = false,\r\n      clean = false,\r\n      clientSpecified = false,\r\n      defaultProps = {}\r\n    } = {}\r\n  ) => {\r\n    let elements = widgetDOMHostElements({\r\n      selector,\r\n      inline,\r\n      clientSpecified\r\n    });\r\n    let loaded = () => {\r\n      if (elements.length > 0) {\r\n        let elements = widgetDOMHostElements({\r\n          selector,\r\n          inline,\r\n          clientSpecified\r\n        });\r\n\r\n        return preactRender(widget, elements, root, clean, defaultProps);\r\n      }\r\n    };\r\n    loaded();\r\n    document.addEventListener(\"DOMContentLoaded\", loaded);\r\n    document.addEventListener(\"load\", loaded);\r\n  };\r\n\r\n  return { render };\r\n};\r\n\r\nexport default habitat;\r\n"],"names":["const","let","elements"],"mappings":";;;;;;;;;AAQAA,IAAM,WAAW,GAAG,UAAA,GAAG,EAAC;EACtB,OAAO,GAAG,CAAC,OAAO,CAAC,YAAY,EAAE,UAAC,GAAG,EAAE,MAAM,EAAE;IAC7C,OAAO,MAAM,CAAC,WAAW,EAAE,CAAC;GAC7B,CAAC,CAAC;CACJ,CAAC;;;;;;;AAOFA,IAAM,iBAAiB,GAAG,YAAG;EAC3B;IACE,QAAQ,CAAC,aAAa;IACtB,CAAC,YAAG;MACFC,IAAI,OAAO,GAAG,QAAQ,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;MACtD,OAAO,OAAO,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;KACpC,GAAG;IACJ;CACH,CAAC;;;;;;;AAOFD,IAAM,uBAAuB,GAAG,UAAC,OAAO,EAAE,YAAiB,EAAE;6CAAP,GAAG,EAAE;;EACzDC,IAAI,KAAK,GAAG,OAAO,CAAC,UAAU,CAAC;;EAE/BA,IAAI,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC;;;EAG5C,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,UAAA,GAAG,EAAC;IAC7B,IAAI,KAAK,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;MAC7BA,IAAI,YAAY,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;MACnC,IAAI,CAAC,YAAY,IAAI,OAAO,YAAY,KAAK,QAAQ,EAAE;QACrD,OAAO,KAAK,CAAC;OACd;MACDA,IAAI,QAAQ,GAAG,YAAY,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,GAAG,EAAE,IAAI,EAAE,CAAC;MAChE,QAAQ,GAAG,WAAW,CAAC,QAAQ,CAAC,CAAC;MACjC,IAAI,YAAY,KAAK,QAAQ,EAAE;QAC7BA,IAAI,SAAS,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,SAAS,CAAC;QACrC,KAAK,CAAC,QAAQ,CAAC,GAAG,SAAS,CAAC;OAC7B;KACF;GACF,CAAC,CAAC;;;EAGH,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,oBAAoB,CAAC,QAAQ,CAAC,EAAE,UAAA,IAAI,EAAC;IAC3DA,IAAI,QAAQ,GAAG,EAAE,CAAA;IACjB,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE;MAC5B,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,YAAY,GAAG,EAAA,OAAO,EAAA;MACxD,IAAI;QACF,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;OACvC,CAAC,MAAM,CAAC,EAAE;QACT,MAAM,IAAI,KAAK,CAAC,CAAC,CAAC;OACnB;MACD,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAA;KAC/B;GACF,CAAC,CAAC;;EAEH,OAAO,KAAK,CAAC;CACd,CAAC;;AAEFD,IAAM,4BAA4B,GAAG,UAAC,aAAa,EAAE;EACnDC,IAAI,cAAc,GAAG,aAAa,CAAC,UAAU,CAAC;EAC9CA,IAAI,QAAQ,GAAG,IAAI,CAAC;;EAEpB,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,UAAA,GAAG,EAAC;IACtC,IAAI,cAAc,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;MACtCD,IAAM,YAAY,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;MAC9C,IAAI,YAAY,KAAK,eAAe,EAAE;QACpC,QAAQ,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC,SAAS,CAAC;OAC1C;KACF;GACF,CAAC,CAAC;EACH,OAAO,QAAQ;CAChB,CAAA;;;;;;;;AAQDA,IAAM,qBAAqB,GAAG;EAC5B,GAAA;EACA;MADE,QAAQ,gBAAE;MAAA,MAAM,cAAE;MAAA,eAAe;;EAEnCC,IAAI,SAAS,GAAG,EAAE,CAAC;EACnBA,IAAI,aAAa,GAAG,iBAAiB,EAAE,CAAC;;EAExC,IAAI,MAAM,KAAK,IAAI,EAAE;IACnBA,IAAI,UAAU,GAAG,aAAa,CAAC,UAAU,CAAC;IAC1C,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;GAC5B;EACD,IAAI,eAAe,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE;;IAEzC,QAAQ,GAAG,4BAA4B,CAAC,aAAa,CAAC,CAAC;GACxD;EACD,IAAI,QAAQ,EAAE;IACZ,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,QAAQ,CAAC,EAAE,UAAA,UAAU,EAAC;MAC9D,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;KAC5B,CAAC,CAAC;GACJ;EACD,OAAO,SAAS,CAAC;CAClB,CAAC;;;;;;AAMFD,IAAM,YAAY,GAAG,UAAC,MAAM,EAAE,YAAY,EAAE,IAAI,EAAE,SAAS,EAAE,YAAY,EAAE;EACzE,YAAY,CAAC,OAAO,CAAC,UAAA,GAAG,EAAC;IACvBC,IAAI,QAAQ,GAAG,GAAG,CAAC;IACnB,IAAI,QAAQ,CAAC,QAAQ,EAAE;MACrB,OAAO;KACR;IACD,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;IACzBA,IAAI,KAAK,GAAG,uBAAuB,CAAC,GAAG,EAAE,YAAY,CAAC,IAAI,YAAY,CAAC;IACvE,GAAG,SAAS,EAAE;MACZ,QAAQ,CAAC,SAAS,GAAG,EAAE,CAAC;KACzB;IACD,OAAO,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,EAAE,KAAK,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;GAC/D,CAAC,CAAC;CACJ,CAAC,AAEF,AAOE;;AC3IFD,IAAM,OAAO,GAAG,UAAA,MAAM,EAAC;;EAErBC,IAAI,MAAM,GAAG,MAAM,CAAC;;EAEpBA,IAAI,IAAI,GAAG,IAAI,CAAC;;EAEhBA,IAAI,MAAM,GAAG;IACX,GAAA;IAOA;6BADC,GAAG,EAAE,CALO;uEAAA,IAAI,CACN;+DAAA,KAAK,CACN;2DAAA,KAAK,CACK;mGAAA,KAAK,CACR;uFAAA,EAAE;;IAGnBA,IAAI,QAAQ,GAAG,qBAAqB,CAAC;MACnC,UAAA,QAAQ;MACR,QAAA,MAAM;MACN,iBAAA,eAAe;KAChB,CAAC,CAAC;IACHA,IAAI,MAAM,GAAG,YAAG;MACd,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;QACvBA,IAAIC,UAAQ,GAAG,qBAAqB,CAAC;UACnC,UAAA,QAAQ;UACR,QAAA,MAAM;UACN,iBAAA,eAAe;SAChB,CAAC,CAAC;;QAEH,OAAO,YAAY,CAAC,MAAM,EAAEA,UAAQ,EAAE,IAAI,EAAE,KAAK,EAAE,YAAY,CAAC,CAAC;OAClE;KACF,CAAC;IACF,MAAM,EAAE,CAAC;IACT,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,MAAM,CAAC,CAAC;IACtD,QAAQ,CAAC,gBAAgB,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;GAC3C,CAAC;;EAEF,OAAO,EAAE,QAAA,MAAM,EAAE,CAAC;CACnB,CAAC,AAEF,AAAuB;;"}